"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[694],{5694:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var r=a(5043),n=a(6058),s=a(3216),o=a(5475),l=a(3003),i=a(7488),d=a(8529),c=a(3032),u=a(6868);var x=a(3910),h=a(7929),m=a(3002),p=a(9563),f=a(6794),g=a(1552),b=a(9804),w=a(5617),v=a(579);const y=()=>{const e=(0,l.wA)(),[t,a]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),{user:j}=(0,l.d4)((e=>e.user)),{soundEnabled:k,toggleSound:S}=(0,u.f)(),{token:C}=(0,r.useContext)(c.Ay),_=(0,s.Zp)(),A=(0,s.zy)(),[I,T]=(0,r.useState)(0),[E,R]=(0,r.useState)(!1),[M,D]=(0,r.useState)(""),[P,L]=(0,r.useState)(!1),z=(0,r.useRef)(null),O=(0,r.useMemo)((()=>new URLSearchParams(A.search).get("q")||""),[A]),[q,K]=(0,r.useState)(O),U=((e,t)=>{const[a,n]=(0,r.useState)(e);return(0,r.useEffect)((()=>{const a=setTimeout((()=>{n(e)}),t);return()=>{clearTimeout(a)}}),[e,t]),a})(q,300),Y=()=>{k&&z.current&&(z.current.currentTime=0,z.current.play().catch((e=>{console.warn("Notification sound failed:",e)})))},$=()=>{navigator.vibrate&&navigator.vibrate([100,50,100])},B=(0,r.useCallback)((async()=>{if(null!==j&&void 0!==j&&j._id)try{const e=await fetch(g.A.notificationCount.url,{credentials:"include",headers:{"Content-Type":"application/json"}}),t=await e.json();t.success&&T(t.count)}catch(e){console.error("\u274c Error fetching unread count:",e)}}),[null===j||void 0===j?void 0:j._id]),F=(0,r.useCallback)((async()=>{if(null!==j&&void 0!==j&&j._id)try{const e=await fetch(g.A.getNewNotifications.url,{credentials:"include",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.success&&Array.isArray(t.newNotifications)){const e=t.newNotifications[0],a=localStorage.getItem("lastNotifiedId");e&&e._id!==a&&(localStorage.setItem("lastNotifiedId",e._id),D(e.message||"New notification received!"),R(!0),L(!0),Y(),$(),setTimeout((()=>L(!1)),2e3),setTimeout((()=>R(!1)),4e3))}}catch(e){console.error("\u274c Error fetching new notifications:",e)}}),[null===j||void 0===j?void 0:j._id,Y,$]);(0,r.useEffect)((()=>{U.trim()&&_(`/search?q=${encodeURIComponent(U)}`)}),[U,_]),(0,r.useEffect)((()=>{B(),F();const e=setInterval(B,5e3),t=setInterval(F,5e3);return()=>{clearInterval(e),clearInterval(t)}}),[B,F]);const G=(0,r.useCallback)((async()=>{N(!0);try{const t=await fetch(g.A.logout_user.url,{method:g.A.logout_user.method,credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`}}),a=await t.json();a.success?(i.oR.success(a.message),e((0,d.m5)(null)),_("/")):i.oR.error(a.message)}catch(t){i.oR.error("Logout failed. Please try again.")}finally{N(!1)}}),[e,_,C]),H=(0,r.useCallback)((()=>a((e=>!e))),[]),X=(0,r.useCallback)((()=>a(!1)),[]),Z=(0,r.useMemo)((()=>((e,t)=>{const a=e.split(/\s+/);return a.length>t?{truncated:a.slice(0,t).join(" ")+"...",original:e,isTruncated:!0}:{truncated:e,original:e,isTruncated:!1}})(M,10)),[M]);return(0,r.useEffect)((()=>{console.log("Header soundEnabled:",k)}),[k]),(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("header",{className:"header-spa left-0 right-0 top-0 pt-8 mb-8 inset-0 bg-black/80 backdrop-blur-md fixed w-full z-50 border-b border-white/20 shadow-md transition-all duration-300 flex items-center justify-between px-4 sm:px-6 lg:px-8",children:[(0,v.jsxs)("div",{className:"w-full mx-auto flex items-center justify-between",children:[(0,v.jsx)("div",{className:"flex items-center gap-2",children:(0,v.jsx)("button",{onClick:H,className:"text-gray-500 hover:text-blue-600 md:hidden","aria-expanded":t,children:(0,v.jsx)(x.g,{icon:h.ckx,className:"h-5 w-5"})})}),(0,v.jsx)(o.N_,{to:"/home",className:"hidden minecraft-font text-[14px] md:flex items-center font-extrabold text-transparent text-2xl bg-clip-text bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 mr-4 tracking-wide",children:"SXN"}),(0,v.jsxs)("div",{className:"hidden md:flex items-center bg-black border-2 rounded-md px-4 py-[6px] w-72 glow-border",children:[(0,v.jsx)(n.Mwp,{className:"text-white h-5 w-5 mr-2"}),(0,v.jsx)("input",{type:"text",placeholder:"Search gift cards...",className:"bg-transparent minecraft-font text-white text-[12px] outline-none w-full placeholder:text-[8px] placeholder-gray-600",value:q,onChange:e=>K(e.target.value)})]}),(0,v.jsx)("div",{className:"md:hidden flex items-center w-full mx-4",children:(0,v.jsxs)("div",{className:"flex items-center bg-black border-2 rounded-md px-2 py-[6px] w-full glow-border",children:[(0,v.jsx)(b.iyI,{className:"text-yellow-700 h-5 w-5 mr-2"}),(0,v.jsx)("input",{type:"text",placeholder:"Search gift cards...",className:"bg-transparent minecraft-font text-white text-[12px] outline-none w-full placeholder:text-[8px] placeholder-gray-600",value:q,onChange:e=>K(e.target.value)})]})}),(0,v.jsxs)("nav",{className:"hidden minecraft-font text-[9px] md:flex items-center gap-2",children:[(0,v.jsx)(o.N_,{to:"/record",className:"px-3 py-1 border border-cyan-500 text-gray-900 hover:bg-cyan-600 hover:text-white rounded transition duration-200",children:"Trade Status"}),(0,v.jsx)(o.N_,{to:"/datapad",className:"px-3 py-1 border border-yellow-500 text-gray-900 hover:bg-yellow-500 hover:text-black rounded transition duration-200",children:"DataPad"}),(null===j||void 0===j?void 0:j.role)===f.A.ADMIN&&(0,v.jsx)(o.N_,{to:"/admin-panel",className:"px-3 py-1 border border-purple-500 text-gray-900 hover:bg-purple-700 hover:text-white rounded transition duration-200",children:"Admin"}),(0,v.jsxs)(o.N_,{to:"/notifications",className:"relative px-3 py-1 border border-emerald-500 text-gray-900 hover:bg-emerald-600 hover:text-white rounded transition duration-200",children:[(0,v.jsx)(m.fmI,{className:P?"animate-ping-slow text-2xl":"text-2xl"}),I>0&&(0,v.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-600 text-white text-xs px-1.5 py-0.5 rounded-full",children:I})]}),(null===j||void 0===j?void 0:j._id)&&(0,v.jsxs)("button",{onClick:G,disabled:y,className:"px-3 py-1 border border-red-500 text-gray-900 hover:bg-red-600 hover:text-white rounded transition flex items-center",children:[(0,v.jsx)(x.g,{icon:h.GxD,className:"mr-1"}),"Logout"]}),(0,v.jsxs)("button",{onClick:S,className:"px-3 py-1 border border-gray-500 text-gray-900 hover:bg-gray-600 hover:text-white rounded transition flex items-center",title:k?"Disable Sound":"Enable Sound",children:[(0,v.jsx)(x.g,{icon:k?h.jY_:h.PKk,className:"mr-1"}),(0,v.jsx)("span",{className:"hidden sm:inline",children:k?"Sound On":"Sound Off"})]})]}),(0,v.jsx)("div",{className:"md:hidden flex items-center ml-4",children:(0,v.jsx)("button",{onClick:S,className:"text-gray-500 hover:text-blue-600",title:k?"Disable Sound":"Enable Sound",children:(0,v.jsx)(x.g,{icon:k?h.jY_:h.PKk,className:"h-5 w-5"})})})]}),E&&(0,v.jsxs)("div",{className:"pop-alert w-screen right-0 left-0 bg-white text-black px-4 py-8 -mt-4 shadow-lg rounded-lg animate-slide-in",children:[(0,v.jsx)("p",{className:"text-sm font-medium",children:Z.truncated}),Z.isTruncated&&(0,v.jsx)(o.N_,{to:"/notifications",className:"block text-blue-500 hover:underline text-xs",children:"Read More"})]}),(0,v.jsx)("audio",{ref:z,src:p,preload:"auto"}),(0,v.jsx)(w.A,{open:t,setOpen:a,handleLogout:G,loading:y,onCloseMenu:X})]})})}}}]);
//# sourceMappingURL=694.c434f821.chunk.js.map